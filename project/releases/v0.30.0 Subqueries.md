# v0.30.0 Subqueries

Molecule now supports SQL subqueries.

### Per-row aggregate

Count cities per country:
```scala
Country.name.join(
  City.id(count).d1.country_(Country.id_)
).query.limit(3).get ==> List(
  ("China", 363),
  ("India", 341),
  ("United States", 274),
)
```


### Per-row limit

Get 3 most populous countries each with their 2 biggest cities
```scala
Country.name.population.d1.join(
  City.name.population.d1.country_(Country.id_).query.limit(2)
).query.limit(6).get ==> List(
  ("China", 1277558000, ("Shanghai", 9696300)),
  ("China", 1277558000, ("Peking", 7472000)),
  ("India", 1013662000, ("Mumbai (Bombay)", 10500000)),
  ("India", 1013662000, ("Delhi", 7206704)),
  ("United States", 278357000, ("New York", 8008278)),
  ("United States", 278357000, ("Los Angeles", 3694820))
)
```


### Global aggregate

Find employees with a salary above the average salary:
```scala
Employee.name.salary.>(Employee.salary_(avg)).query.get ==> List(
  ("Liz", 70000),
)
```


### Filtering

Republics with more than 8 unofficial languages:
```scala
Country.name.governmentForm_("Republic").join(
  CountryLanguage.language(count).>(8).d1
    .isOfficial_(false)
    .country_(Country.id_)
).query.get ==> List(
  ("Congo, The Democratic Republic of the", 10),
  ("Kenya", 10),
  ("Tanzania", 10),
)
```


## Read more

Read the full [subquery documentation](https://www.scalamolecule.org/database/query/subquery.html)